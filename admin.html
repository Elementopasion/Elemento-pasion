<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración - Moda Elegante</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Mismo CSS del admin anterior, SE MANTIENE */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .admin-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            width: 100%;
            max-width: 1000px;
        }
        
        /* ... COPIA TODO EL CSS DEL admin.html ANTERIOR ... */
        
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1><i class="fas fa-cog"></i> Panel de Administración</h1>
            <p>Moda Elegante - Gestión de Productos</p>
            <p style="font-size: 14px; margin-top: 10px; color: #27ae60;">
                <i class="fas fa-cloud"></i> Conectado a Google Sheets
            </p>
        </div>
        
        <div class="admin-content">
            <!-- Sección de Login -->
            <div class="login-section" id="loginSection">
                <h2>Acceso Restringido</h2>
                <p>Ingresa la contraseña de administrador para continuar:</p>
                <input type="password" id="adminPassword" class="login-input" placeholder="Contraseña de administrador" value="admin123">
                <button class="login-btn" onclick="checkPassword()">
                    <i class="fas fa-sign-in-alt"></i> Ingresar al Panel
                </button>
                <div style="margin-top: 20px; padding: 15px; background: #e8f4fc; border-radius: 8px;">
                    <p style="margin: 0; color: #2c3e50; font-size: 14px;">
                        <strong>Nota:</strong> Los productos ahora se guardan en Google Sheets y están disponibles en todos los dispositivos.
                    </p>
                </div>
                <p style="margin-top: 20px; font-size: 14px; color: #666;">
                    <a href="index.html" class="back-link">
                        <i class="fas fa-arrow-left"></i> Volver a la tienda
                    </a>
                </p>
            </div>
            
            <!-- Panel de Administración -->
            <div class="admin-panel" id="adminPanel">
                <div class="admin-tabs">
                    <button class="tab-btn active" onclick="openTab('addProduct')">
                        <i class="fas fa-plus-circle"></i> Agregar Producto
                    </button>
                    <button class="tab-btn" onclick="openTab('manageProducts')">
                        <i class="fas fa-edit"></i> Gestionar Productos
                    </button>
                    <button class="tab-btn" onclick="openTab('syncStatus')">
                        <i class="fas fa-sync"></i> Estado de Sincronización
                    </button>
                </div>
                
                <!-- Tab: Agregar Producto -->
                <div class="tab-content active" id="addProductTab">
                    <h2 style="color: #2c3e50; margin-bottom: 20px;">Agregar Nuevo Producto</h2>
                    
                    <div id="addProductForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="productName">Nombre del Producto *</label>
                                <input type="text" id="productName" class="form-control" placeholder="Ej: Camisa Casual Hombre">
                            </div>
                            
                            <div class="form-group">
                                <label for="productPrice">Precio ($) *</label>
                                <input type="number" id="productPrice" class="form-control" placeholder="Ej: 34.99" step="0.01" min="0">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="productCategory">Categoría *</label>
                                <select id="productCategory" class="form-control">
                                    <option value="">Seleccionar categoría</option>
                                    <option value="hombre">Ropa de Hombre</option>
                                    <option value="mujer">Ropa de Mujer</option>
                                    <option value="ninos">Ropa de Niños</option>
                                    <option value="accesorios">Accesorios</option>
                                    <option value="calzado">Calzado</option>
                                    <option value="ofertas">Ofertas</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>¿Destacar en página principal?</label>
                                <div style="margin-top: 10px;">
                                    <label style="margin-right: 20px;">
                                        <input type="radio" name="featured" value="true" checked> Sí
                                    </label>
                                    <label>
                                        <input type="radio" name="featured" value="false"> No
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Imagen del Producto *</label>
                            <div class="image-upload-container">
                                <p>Para usar Google Sheets, necesitas subir la imagen a un servicio de hosting y pegar la URL aquí.</p>
                                <p style="font-size: 14px; color: #666; margin: 10px 0;">
                                    Recomendamos: <a href="https://imgbb.com/" target="_blank">imgBB.com</a> (gratis)
                                </p>
                                <input type="text" id="productImageUrl" class="form-control" placeholder="https://ejemplo.com/imagen.jpg">
                                <p style="font-size: 12px; color: #666; margin-top: 10px;">
                                    Sube tu imagen a imgBB, copia el enlace directo y pégalo aquí.
                                </p>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="productDescription">Descripción (opcional)</label>
                            <textarea id="productDescription" class="form-control" rows="4" placeholder="Describe el producto..."></textarea>
                        </div>
                        
                        <button class="btn-primary" onclick="addNewProduct()" id="addProductBtn">
                            <i class="fas fa-cloud-upload-alt"></i> Guardar en Google Sheets
                        </button>
                        <div id="addProductStatus" style="margin-top: 10px;"></div>
                    </div>
                    
                    <div style="margin-top: 30px; padding: 15px; background: #e8f4fc; border-radius: 6px;">
                        <p style="color: #2c3e50; margin-bottom: 10px;"><strong>¿Cómo subir imágenes?</strong></p>
                        <ol style="color: #666; padding-left: 20px;">
                            <li>Ve a <a href="https://imgbb.com/" target="_blank">imgBB.com</a></li>
                            <li>Haz clic en "Start Uploading"</li>
                            <li>Selecciona tu imagen</li>
                            <li>Copia el enlace que dice "Direct Link"</li>
                            <li>Pega el enlace en el campo de arriba</li>
                        </ol>
                    </div>
                </div>
                
                <!-- Tab: Gestionar Productos -->
                <div class="tab-content" id="manageProductsTab">
                    <h2 style="color: #2c3e50; margin-bottom: 20px;">Productos en Google Sheets</h2>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <p style="color: #666;">Total de productos: <span id="totalProducts">0</span></p>
                        <button class="btn-secondary" onclick="loadProducts()">
                            <i class="fas fa-sync"></i> Actualizar Lista
                        </button>
                    </div>
                    
                    <div class="products-list" id="productsList">
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <div class="spinner" style="border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
                            <p>Cargando productos desde Google Sheets...</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button class="btn-secondary" onclick="exportProducts()">
                            <i class="fas fa-download"></i> Exportar a JSON
                        </button>
                        <button class="btn-danger" onclick="deleteAllProducts()" style="float: right;">
                            <i class="fas fa-trash"></i> Eliminar Todos
                        </button>
                    </div>
                </div>
                
                <!-- Tab: Estado de Sincronización -->
                <div class="tab-content" id="syncStatusTab">
                    <h2 style="color: #2c3e50; margin-bottom: 20px;">Estado del Sistema</h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div style="background: #e8f4fc; padding: 20px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 36px; color: #3498db; margin-bottom: 10px;">
                                <i class="fas fa-database"></i>
                            </div>
                            <h3 style="color: #2c3e50; margin-bottom: 10px;">Google Sheets</h3>
                            <p id="sheetsStatus" style="color: #27ae60; font-weight: bold;">
                                <i class="fas fa-check-circle"></i> Conectado
                            </p>
                        </div>
                        
                        <div style="background: #f0f7ff; padding: 20px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 36px; color: #9b59b6; margin-bottom: 10px;">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <h3 style="color: #2c3e50; margin-bottom: 10px;">Productos</h3>
                            <p id="productsCount" style="color: #2c3e50; font-weight: bold;">
                                0 productos
                            </p>
                        </div>
                        
                        <div style="background: #f9f0ff; padding: 20px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 36px; color: #e74c3c; margin-bottom: 10px;">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <h3 style="color: #2c3e50; margin-bottom: 10px;">Disponibilidad</h3>
                            <p style="color: #27ae60; font-weight: bold;">
                                <i class="fas fa-check-circle"></i> Todos los dispositivos
                            </p>
                        </div>
                    </div>
                    
                    <div style="background: #fff3cd; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ffc107;">
                        <h3 style="color: #856404; margin-bottom: 10px;">
                            <i class="fas fa-info-circle"></i> Información Importante
                        </h3>
                        <p style="color: #856404; margin-bottom: 10px;">
                            Los productos ahora se almacenan en Google Sheets y están disponibles en:
                        </p>
                        <ul style="color: #856404; padding-left: 20px;">
                            <li>Todos los celulares</li>
                            <li>Todas las computadoras</li>
                            <li>Cualquier navegador</li>
                            <li>Sin importar desde dónde se agreguen</li>
                        </ul>
                    </div>
                    
                    <div style="background: #d4edda; padding: 20px; border-radius: 8px; border-left: 4px solid #28a745;">
                        <h3 style="color: #155724; margin-bottom: 10px;">
                            <i class="fas fa-link"></i> Enlace de Google Sheets
                        </h3>
                        <p style="color: #155724; margin-bottom: 10px;">
                            Puedes ver y editar manualmente los productos en:
                        </p>
                        <div style="background: white; padding: 10px; border-radius: 4px; border: 1px solid #c3e6cb; margin-bottom: 10px;">
                            <code id="sheetsLink">https://docs.google.com/spreadsheets/d/...</code>
                        </div>
                        <button class="btn-secondary" onclick="openSheetsLink()" style="margin-right: 10px;">
                            <i class="fas fa-external-link-alt"></i> Abrir Google Sheets
                        </button>
                        <button class="btn-secondary" onclick="copySheetsLink()">
                            <i class="fas fa-copy"></i> Copiar Enlace
                        </button>
                    </div>
                </div>
                
                <div style="margin-top: 30px; text-align: center;">
                    <a href="index.html" class="back-link">
                        <i class="fas fa-store"></i> Ir a la Tienda
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURACIÓN
        // ============================================
        
        // ¡¡¡IMPORTANTE!!! Cambia esta URL por la de TU Google Apps Script
        const API_URL = 'https://script.google.com/macros/s/AKfycbwV5lB9P7O7p5n8Q2q3Q4W5R6X7Y8Z9a0b1c2d3e4f5g6h7i8j9k0l1m2n3o4p5/exec';
        
        const ADMIN_PASSWORD = "admin123";
        let allProducts = [];
        
        // ============================================
        // FUNCIONES DEL SISTEMA
        // ============================================
        
        function checkPassword() {
            const password = document.getElementById('adminPassword').value;
            
            if (password === ADMIN_PASSWORD) {
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                loadProducts();
                updateStatus();
            } else {
                alert('Contraseña incorrecta');
            }
        }
        
        function openTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'syncStatus') {
                updateStatus();
            }
        }
        
        // ============================================
        // FUNCIONES DE PRODUCTOS (GOOGLE SHEETS)
        // ============================================
        
        async function loadProducts() {
            const container = document.getElementById('productsList');
            container.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div class="spinner" style="border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto 10px;"></div>
                    <p>Cargando desde Google Sheets...</p>
                </div>
            `;
            
            try {
                const response = await fetch(`${API_URL}?action=getProducts`);
                allProducts = await response.json();
                
                displayProducts(allProducts);
                updateStatus();
                
            } catch (error) {
                console.error('Error cargando productos:', error);
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #e74c3c;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px;"></i>
                        <p>Error conectando con Google Sheets</p>
                        <p style="font-size: 14px; margin-top: 10px;">${error.message}</p>
                        <button class="btn-secondary" onclick="loadProducts()" style="margin-top: 20px;">
                            <i class="fas fa-redo"></i> Reintentar
                        </button>
                    </div>
                `;
            }
        }
        
        function displayProducts(products) {
            const container = document.getElementById('productsList');
            const totalElement = document.getElementById('totalProducts');
            
            totalElement.textContent = products.length;
            
            if (products.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-box-open" style="font-size: 48px; margin-bottom: 20px; color: #ddd;"></i>
                        <p>No hay productos en Google Sheets.</p>
                        <p>Agrega tu primer producto en la pestaña "Agregar Producto".</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = products.map((product, index) => `
                <div class="product-item">
                    <img src="${product.image}" class="product-image" alt="${product.name}" onerror="this.src='https://via.placeholder.com/80?text=Imagen+no+disponible'">
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                        <div class="product-meta">
                            Categoría: ${getCategoryName(product.category)} | 
                            Precio: $${parseFloat(product.price).toFixed(2)} | 
                            ${product.featured === 'true' || product.featured === true ? '⭐ Destacado' : 'Normal'}
                        </div>
                        ${product.description ? `<div style="font-size: 13px; color: #888; margin-top: 5px;">${product.description.substring(0, 100)}${product.description.length > 100 ? '...' : ''}</div>` : ''}
                    </div>
                    <div class="product-actions">
                        <button class="btn-secondary" onclick="editProduct('${product.id}')">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn-danger" onclick="deleteProduct('${product.id}')">
                            <i class="fas fa-trash"></i> Eliminar
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function getCategoryName(categoryCode) {
            const categories = {
                'hombre': 'Hombre',
                'mujer': 'Mujer',
                'ninos': 'Niños',
                'accesorios': 'Accesorios',
                'calzado': 'Calzado',
                'ofertas': 'Ofertas'
            };
            return categories[categoryCode] || categoryCode;
        }
        
        async function addNewProduct() {
            const name = document.getElementById('productName').value.trim();
            const price = document.getElementById('productPrice').value;
            const category = document.getElementById('productCategory').value;
            const description = document.getElementById('productDescription').value.trim();
            const featured = document.querySelector('input[name="featured"]:checked').value;
            const imageUrl = document.getElementById('productImageUrl').value.trim();
            
            // Validaciones
            if (!name || !price || !category || !imageUrl) {
                alert('Por favor completa todos los campos obligatorios (*)');
                return;
            }
            
            if (parseFloat(price) <= 0) {
                alert('El precio debe ser mayor a 0');
                return;
            }
            
            if (!imageUrl.startsWith('http')) {
                alert('Por favor ingresa una URL válida para la imagen');
                return;
            }
            
            const btn = document.getElementById('addProductBtn');
            const status = document.getElementById('addProductStatus');
            
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Guardando...';
            btn.disabled = true;
            status.innerHTML = '<span style="color: #3498db;">Enviando a Google Sheets...</span>';
            
            try {
                const productData = {
                    name: name,
                    price: price,
                    category: category,
                    description: description,
                    featured: featured,
                    image: imageUrl
                };
                
                const params = new URLSearchParams({
                    action: 'addProduct',
                    ...productData
                });
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: params
                });
                
                const result = await response.json();
                
                if (result.success) {
                    status.innerHTML = '<span style="color: #27ae60;"><i class="fas fa-check"></i> Producto guardado exitosamente!</span>';
                    
                    // Limpiar formulario
                    document.getElementById('productName').value = '';
                    document.getElementById('productPrice').value = '';
                    document.getElementById('productCategory').value = '';
                    document.getElementById('productDescription').value = '';
                    document.getElementById('productImageUrl').value = '';
                    
                    // Recargar lista
                    setTimeout(() => {
                        loadProducts();
                        updateStatus();
                    }, 1000);
                    
                } else {
                    status.innerHTML = '<span style="color: #e74c3c;"><i class="fas fa-times"></i> Error al guardar el producto</span>';
                }
                
            } catch (error) {
                console.error('Error:', error);
                status.innerHTML = `<span style="color: #e74c3c;"><i class="fas fa-times"></i> Error de conexión: ${error.message}</span>`;
            } finally {
                btn.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> Guardar en Google Sheets';
                btn.disabled = false;
                
                // Limpiar mensaje después de 5 segundos
                setTimeout(() => {
                    status.innerHTML = '';
                }, 5000);
            }
        }
        
        async function editProduct(productId) {
            const product = allProducts.find(p => p.id == productId);
            
            if (product) {
                document.getElementById('productName').value = product.name;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productDescription').value = product.description || '';
                document.getElementById('productImageUrl').value = product.image;
                document.querySelector(`input[name="featured"][value="${product.featured}"]`).checked = true;
                
                openTab('addProduct');
                
                alert('Producto cargado para edición. Modifica y haz clic en "Guardar". Se actualizará en Google Sheets.');
            }
        }
        
        async function deleteProduct(productId) {
            if (!confirm('¿Estás seguro de que quieres eliminar este producto de Google Sheets?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}?action=deleteProduct&id=${productId}`);
                const result = await response.json();
                
                if (result.success) {
                    alert('Producto eliminado de Google Sheets');
                    loadProducts();
                    updateStatus();
                } else {
                    alert('Error al eliminar el producto');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error de conexión al eliminar');
            }
        }
        
        async function deleteAllProducts() {
            if (!confirm('⚠️ ¿ELIMINAR TODOS LOS PRODUCTOS de Google Sheets?\n\nEsta acción no se puede deshacer.')) {
                return;
            }
            
            if (!confirm('⛔ CONFIRMACIÓN FINAL: Esto borrará TODOS los productos permanentemente.')) {
                return;
            }
            
            try {
                // Para eliminar todos, necesitamos eliminarlos uno por uno
                for (const product of allProducts) {
                    await fetch(`${API_URL}?action=deleteProduct&id=${product.id}`);
                }
                
                alert('Todos los productos han sido eliminados de Google Sheets');
                loadProducts();
                updateStatus();
                
            } catch (error) {
                console.error('Error:', error);
                alert('Error al eliminar los productos');
            }
        }
        
        function exportProducts() {
            if (allProducts.length === 0) {
                alert('No hay productos para exportar');
                return;
            }
            
            const dataStr = JSON.stringify(allProducts, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `productos-google-sheets-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert(`Exportados ${allProducts.length} productos a JSON`);
        }
        
        // ============================================
        // FUNCIONES DE ESTADO
        // ============================================
        
        async function updateStatus() {
            try {
                // Verificar conexión con Google Sheets
                const response = await fetch(`${API_URL}?action=getProducts`);
                const products = await response.json();
                
                document.getElementById('productsCount').textContent = `${products.length} productos`;
                document.getElementById('sheetsStatus').innerHTML = '<i class="fas fa-check-circle"></i> Conectado';
                document.getElementById('sheetsStatus').style.color = '#27ae60';
                
            } catch (error) {
                document.getElementById('sheetsStatus').innerHTML = '<i class="fas fa-times-circle"></i> Sin conexión';
                document.getElementById('sheetsStatus').style.color = '#e74c3c';
            }
        }
        
        function openSheetsLink() {
            // Esto abre tu Google Sheets (necesitas el enlace real)
            const sheetsId = API_URL.match(/\/d\/([^\/]+)/);
            if (sheetsId && sheetsId[1]) {
                window.open(`https://docs.google.com/spreadsheets/d/${sheetsId[1]}`, '_blank');
            } else {
                alert('No se pudo obtener el enlace de Google Sheets. Abre manualmente tu Google Drive.');
            }
        }
        
        function copySheetsLink() {
            const sheetsId = API_URL.match(/\/d\/([^\/]+)/);
            if (sheetsId && sheetsId[1]) {
                const link = `https://docs.google.com/spreadsheets/d/${sheetsId[1]}`;
                navigator.clipboard.writeText(link).then(() => {
                    alert('Enlace copiado al portapapeles');
                });
            }
        }
        
        // ============================================
        // INICIALIZACIÓN
        // ============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('adminPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkPassword();
                }
            });
            
            document.getElementById('adminPassword').focus();
            
            // Añadir animación para spinner
            const style = document.createElement('style');
            style.textContent = `
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
        });
    </script>
</body>
</html>
